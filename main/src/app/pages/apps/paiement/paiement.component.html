<mat-card class="cardWithShadow no-shadow">
  <mat-card-content class="p-24">
    <div class="row justify-content-between" style="margin-bottom: 20px;">
      <div class="col-lg-2">
        <mat-form-field appearance="outline" class="w-100 hide-hint gray-background">
          <mat-label>Trier par Membre</mat-label>
          <mat-select [(ngModel)]="selectedSortingOption" (selectionChange)="applySorting()">
            <mat-option *ngFor="let sortingOption of sortingOptions" [value]="sortingOption.value">{{ sortingOption.viewValue }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-lg-3">
        <mat-form-field appearance="outline" class="w-100 hide-hint gray-background">
          <mat-label>Filtrer par Ã©quipe</mat-label>
          <mat-select [(ngModel)]="selectedEquipe" (selectionChange)="applyFilterByEquipe()">
            <mat-option *ngFor="let equipe of equipeOptions" [value]="equipe">{{ equipe }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-lg-3">
        <mat-form-field appearance="outline" class="w-100 hide-hint gray-background">
          <mat-label>Filtrer par type abonnement</mat-label>
          <mat-select [(ngModel)]="selectedType" (selectionChange)="applyFilterByType()">
            <mat-option *ngFor="let type of typeAbonnements" [value]="type">{{ type }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-lg-3">
        <mat-form-field appearance="outline" class="w-100 hide-hint gray-background">
          <mat-label>Filtrer par statut</mat-label>
          <mat-select [(ngModel)]="selectedStatut" (selectionChange)="applyFilterByStatut()">
            <mat-option *ngFor="let statut of statutOptions" [value]="statut">{{ statut }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-lg-1 d-flex align-items-center justify-content-end">
        <button mat-icon-button color="primary" (click)="resetFilters()" style="color: gray;">
          <mat-icon>refresh</mat-icon>
        </button>
      </div>
    </div>



  </mat-card-content>
</mat-card>

<mat-card class="cardWithShadow gray-background">
  <mat-card-content class="p-24 gray-background">
    <div class="row justify-content-between">
      <div class="col-lg-6">
        <h2>Liste des paiements</h2>
      </div>
      <div class="col-lg-6 d-flex align-items-center justify-content-end">
        <mat-form-field appearance="outline" class="w-50 hide-hint mr-2" style="margin-right: 10px;">
          <input matInput placeholder="Search Paiement" (keyup)="applyFilter($any($event.target).value)" />
          <mat-icon matSuffix>
            <i-tabler name="search" class="icon-20"></i-tabler>
          </mat-icon>
        </mat-form-field>
        <button mat-flat-button color="primary" (click)="openAddPaiementDialog()">
          <mat-icon>add</mat-icon> Ajouter
        </button>
      </div>
    </div>
    
    
    <div class="table-responsive gray-background">
      <table mat-table [dataSource]="dataSource" class="w-100 gray-background">

        <ng-container matColumnDef="membre">
          <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
            Membre
          </th>
          <td mat-cell *matCellDef="let element" class="f-s-14">{{ element.adherent.firstname }} {{
            element.adherent.lastname }}</td>
        </ng-container>

        <ng-container matColumnDef="equipe">
          <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
            Equipe
          </th>
          <td mat-cell *matCellDef="let element" class="f-s-14">{{ element.adherent.nomEquipe }}</td>
        </ng-container>

        <ng-container matColumnDef="telephone">
          <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
            Telephone
          </th>
          <td mat-cell *matCellDef="let element" class="f-s-14">{{ element.adherent.telephone }}</td>
        </ng-container>

        <ng-container matColumnDef="type_abonnement">
          <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
            Type Abonnement
          </th>
          <td mat-cell *matCellDef="let element" class="f-s-14">{{ element.typeAbonnement }}</td>
        </ng-container>

        <ng-container matColumnDef="date_abonnement">
          <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
            Date Abonnement
          </th>
          <td mat-cell *matCellDef="let element" class="f-s-14" [ngClass]="{'text-danger': element.retardPaiement > 0}">
            {{ element.dateFin | date }}
            <span *ngIf="element.retardPaiement > 0" class="ml-1">{{ element.retardPaiement }} jours de retard</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="statut">
          <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
            Statut
          </th>
          <td mat-cell *matCellDef="let element" class="f-s-14">
            <mat-form-field appearance="outline" class="smaller-select">
              <mat-label>Statut</mat-label>
              <mat-select [(ngModel)]="element.adherent.statutAdherent" (selectionChange)="onStatusChange(element)"
                class="custom-select" [style.background-color]="getBackgroundColor(element.adherent.statutAdherent)"
                [style.color]="getTextColor(element.adherent.statutAdherent)">
                <mat-option *ngFor="let status of statutOptions" [value]="status">{{ formatEnumValue(status) }}</mat-option>
              </mat-select>
            </mat-form-field>
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
            Actions
          </th>
          <!-- Inside the table cell for actions -->
          <td mat-cell *matCellDef="let element" class="f-s-14">
            <button mat-icon-button style="color: gray;" (click)="openUpdateDialog(element)">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button style="color: gray;" (click)="openPaymentHistoryPopup(element.adherent.id)">
              <mat-icon>history</mat-icon>
            </button>
            <button mat-icon-button style="color: gray;" (click)="openMembreDetailPopup(element.adherent.id)">
              <mat-icon>person</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="onDeletePaiement(element.id)">
              <mat-icon>delete_outline</mat-icon>
            </button>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
      <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons class="gray-background"></mat-paginator>
    </div>
  </mat-card-content>
</mat-card>

<style>
  .text-danger {
    color: red;
  }

  .custom-select {
    /* background color for the select */
    background-color: red;
    /* border color */
    border: 1px solid #cccccc;
    /* border radius */
    border-radius: 4px;
    /* color for the text */
    color: #333333;
    /* font size */
    font-size: 14px;
    /* padding */
    padding: 5px 10px;
  }

  .gray-background {
    background-color: #FAFAFA;
  }

  .no-shadow {
    box-shadow: none;
  }
</style>