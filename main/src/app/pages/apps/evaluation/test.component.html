<div class="bg-third rounded-3xl">
  <div class="flex justify-center py-4 px-32">
    <div class=" w-full  ">
      <div class=" ">
        <form [formGroup]="testForm">
          <div *ngFor="let category of test?.categories; let i = index">
            <div class="bg-third border-2 border-second rounded-3xl mb-4 min-h-8 py-4 px-8">
              <div class="grid grid-cols-2">
                <div>

                  <h1 class="text-black font-medium">{{ category.categorieName |titlecase }}</h1>
                </div>
                <div class="flex justify-end gap-8">

                  <mat-slide-toggle
                    (change)="toggleCategory(category.categorieName, i)"
                    [checked]="selectedCategoryToOpenIndex === i"
                    color="primary">
                  </mat-slide-toggle>
                  <button (click)="deleteCategorie(test, category)">
                    <i-tabler name="trash"></i-tabler>
                  </button>
                  <button (change)="toggleCategoryView(i)">
                    <i-tabler [name]="i===selectedCategoryToOpenIndex?'minus': 'plus'"></i-tabler>
                  </button>
                </div>
              </div>
              <div *ngIf="selectedCategoryToOpenIndex === i" class=" mt-4">
                <div>
                  <div *ngFor="let kpi of category.kpis">
                    <div class="grid grid-cols-2 align-items-center mb-4 ">
                      <div>
                        {{ kpi.kpiType }}
                      </div>
                      <div class="flex justify-end">
                        <i-tabler (click)="deleteKpi(kpi)" class="icon-18 cursor-pointer ml-2" name="trash"></i-tabler>
                      </div>
                    </div>
                  </div>
                </div>
                <div *ngIf="selectedCategoryIndex === i" class="flex justify-center mb-4">
                  <input class="mt-1.5 h-10 px-4 w-full rounded-lg border-second border-2 bg-transparent  text-black sm:text-sm" formControlName="newKpiValue" matInput
                         placeholder="Nouveau KPI" (keyup.enter)="addKpi(category.id)"/>
                  <button (click)="addKpi(category.id)" class=" ml-4 ">
                    <i class="bi bi-plus-circle-fill"></i>
                  </button>
                </div>
                <div class="flex justify-center">
                  <button (click)="selectCategory(i)" class="flex justify-center gap-4">
                    <i class="bi bi-plus-circle-fill"></i>
                    <h1 class="m-0">Ajouter une sous-catégorie</h1>

                  </button>
                </div>
              </div>

            </div>

          </div>
          <div class="flex justify-center">
            <button (click)="addCategorie('AddCat', test, test.id)" class="flex justify-center gap-4">
              <i class="bi bi-plus-circle-fill"></i>
              <h1 class="m-0">Ajouter une catégorie</h1>

            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

