<mat-card class="cardWithShadow gray-background">
    <mat-card-content class="p-24">
        <h2>Ajouter des équipes</h2>
        <div *ngFor="let equipe of equipes; let i = index">
            <form #equipeForm="ngForm" (ngSubmit)="onSubmit()">
                <table>
                    <tr>
                        <th>Nom</th>
                        <th>Genre</th>
                        <th>Groupe d'âge</th>
                        <th>Couleur</th>
                        <th>Select discipline</th>
                        <th>Logo</th>
                        <th></th> <!-- Empty header for the delete button -->
                    </tr>
                    <tr>
                        <td>
                            <mat-form-field appearance="outline" class="w-100 hide-hint" style="width: 100%;">
                                <input matInput placeholder="Nom" name="nom" [(ngModel)]="equipe.nom" required
                                    #nom="ngModel">
                            </mat-form-field>
                        </td>
                        <td>
                            <mat-form-field appearance="outline" class="w-100 hide-hint" style="width: 150px;">
                                <mat-label>Select genre</mat-label>
                                <mat-select placeholder="Genre" [(ngModel)]="equipe.genre" name="genre" required
                                    #genre="ngModel">
                                    <mat-option *ngFor="let genre of genres" [value]="genre">
                                        {{ genre }}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </td>
                        <td>
                            <mat-form-field appearance="outline" class="w-100 hide-hint" style="width: 100%;">
                                <input matInput placeholder="Groupe d'âge" name="groupeAge"
                                    [(ngModel)]="equipe.groupeAge" required #groupeAge="ngModel">
                            </mat-form-field>
                        </td>
                        <td>
                            <mat-form-field appearance="outline" class="w-100 hide-hint" style="width: 130px;">
                                <input matInput type="color" placeholder="Couleur" name="couleur"
                                    [(ngModel)]="equipe.couleur" required #couleur="ngModel">
                            </mat-form-field>
                        </td>
                        <td>
                            <mat-form-field appearance="outline" class="w-100 hide-hint" style="width: 175px;">
                                <mat-label>Select discipline</mat-label>
                                <mat-select placeholder="Discipline" [(ngModel)]="equipe.discipline" name="discipline"
                                    required #discipline="ngModel">
                                    <mat-option *ngFor="let discipline of disciplines" [value]="discipline">
                                        {{ discipline.nom }}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </td>
                        <td>
                            <div class="custom-file-upload">
                                <label for="logo-{{i}}" class="file-upload-label">
                                    <mat-icon>image</mat-icon><span>Upload Logo</span>
                                    <input type="file" id="logo-{{i}}" name="logo" (change)="uploadFile($event, equipe)"
                                        #fileInput />
                                </label>
                            </div>
                        </td>
                        <td>
                            <button mat-icon-button color="warn" (click)="removeEquipeForm(i)"
                                *ngIf="equipes.length > 1">
                                <mat-icon>delete_outline</mat-icon>
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div
                                *ngIf="equipeForm.controls['nom'].invalid && (equipeForm.controls['nom'].dirty || equipeForm.controls['nom'].touched)">
                                <span class="error-message">Le nom est requis</span>
                            </div>
                        </td>
                        <td>
                            <div
                                *ngIf="equipeForm.controls['genre'].invalid && (equipeForm.controls['genre'].dirty || equipeForm.controls['genre'].touched)">
                                <span class="error-message">Veuillez sélectionner un genre</span>
                            </div>
                        </td>
                        <td>
                            <div
                                *ngIf="equipeForm.controls['groupeAge'].invalid && (equipeForm.controls['groupeAge'].dirty || equipeForm.controls['groupeAge'].touched)">
                                <span class="error-message">Veuillez saisir un groupe d'âge</span>
                            </div>
                        </td>
                        <td>
                            <div
                                *ngIf="equipeForm.controls['couleur'].invalid && (equipeForm.controls['couleur'].dirty || equipeForm.controls['couleur'].touched)">
                                <span class="error-message">Veuillez choisir une couleur</span>
                            </div>
                        </td>
                        <td>
                            <div
                                *ngIf="equipeForm.controls['discipline'].invalid && (equipeForm.controls['discipline'].dirty || equipeForm.controls['discipline'].touched)">
                                <span class="error-message">Veuillez sélectionner une discipline</span>
                            </div>
                        </td>
                    </tr>
                </table>
            </form>
            <!-- Track the forms for validation -->
            <ng-container *ngIf="forms.push(equipeForm)"></ng-container>
        </div>
        <button mat-raised-button color="accent" (click)="addEquipeForm()"
            style="margin-right: 10px; margin-top: 10px; margin-left: 3px; background-color: #7B7B7B;">
            <mat-icon>add</mat-icon> Ajouter un autre formulaire
        </button>
        <button mat-raised-button color="primary" (click)="onSubmit()"
            [disabled]="!areAllFormsValid() || uploadingImage" style="margin-top: 10px;">
            <span *ngIf="uploadingImage">Uploading Logo...</span>
            <span *ngIf="!uploadingImage">Ajouter</span>
        </button>
    </mat-card-content>
</mat-card>


<mat-card class="cardWithShadow gray-background">
    <mat-card-content class="p-24">
        <div class="row justify-content-between" style="margin-bottom: 20px;">
            <div class="col-lg-3">
                <mat-form-field appearance="outline" class="w-100 hide-hint gray-background">
                    <mat-label>Trier par Equipe</mat-label>
                    <mat-select [(ngModel)]="selectedSortingOption" (selectionChange)="applySorting()">
                        <mat-option *ngFor="let sortingOption of sortingOptions" [value]="sortingOption.value">{{
                            sortingOption.viewValue }}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div class="col-lg-4">
                <mat-form-field appearance="outline" class="w-100 hide-hint gray-background">
                    <mat-label>Filtrer par genre</mat-label>
                    <mat-select [(ngModel)]="selectedGenreEquipe" (selectionChange)="applyFilterByGenreEquipe()">
                        <mat-option *ngFor="let genre of genreEquipeOptions" [value]="genre">{{ genre }}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div class="col-lg-4">
                <mat-form-field appearance="outline" class="w-100 hide-hint gray-background">
                    <mat-label>Filtrer par discipline</mat-label>
                    <mat-select [(ngModel)]="selectedDiscipline" (selectionChange)="applyFilterByDiscipline()">
                        <mat-option *ngFor="let discipline of disciplines" [value]="discipline.nom">{{ discipline.nom
                            }}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div class="col-lg-1 d-flex align-items-center justify-content-end">
                <button mat-icon-button color="primary" (click)="resetFilters()" style="color: gray;">
                    <mat-icon>refresh</mat-icon>
                </button>
            </div>
        </div>
    </mat-card-content>
    <mat-card-content class="p-24">
        <div class="row justify-content-between">
            <div class="col-lg-6">
                <h2>Liste des equipes</h2>
            </div>
            <div class="col-lg-6 d-flex align-items-center justify-content-end">
                <mat-form-field appearance="outline" class="w-50 hide-hint mr-2" style="margin-right: 10px;">
                    <input matInput placeholder="Search Equipe" (keyup)="applyFilter($any($event.target).value)" />
                    <mat-icon matSuffix>
                        <i-tabler name="search" class="icon-20"></i-tabler>
                    </mat-icon>
                </mat-form-field>
            </div>
        </div>

        <div class="table-responsive ">
            <table mat-table [dataSource]="dataSource" class="w-100 gray-background">
                <!-- Column definitions -->

                <!-- Column: logo -->
                <ng-container matColumnDef="logo">
                    <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">Logo</th>
                    <td mat-cell *matCellDef="let element">
                        <img [src]="element.logo" alt="Logo" width="40" />
                    </td>
                </ng-container>

                <!-- Column: nom -->
                <ng-container matColumnDef="nom">
                    <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">Nom</th>
                    <td mat-cell *matCellDef="let element" class="f-w-600 mat-subtitle-1 f-s-16 m-t-0">
                        {{ element.nom }}
                    </td>
                </ng-container>

                <!-- Column: type -->
                <ng-container matColumnDef="genre">
                    <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">Genre</th>
                    <td mat-cell *matCellDef="let element">{{ element.genre }}</td>
                </ng-container>

                <!-- Column: discipline -->
                <ng-container matColumnDef="discipline">
                    <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">Discipline</th>
                    <td mat-cell *matCellDef="let element">{{ element.discipline.nom }}</td>
                </ng-container>



                <!-- Column: type -->
                <ng-container matColumnDef="groupAge">
                    <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">Groupe d'age</th>
                    <td mat-cell *matCellDef="let element">{{ element.groupeAge }}</td>
                </ng-container>

                <!-- Column: type -->
                <ng-container matColumnDef="couleur">
                    <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">Couleur</th>
                    <td mat-cell *matCellDef="let element">
                        <div [style.backgroundColor]="element.couleur" style="width: 20px; height: 20px;"></div>
                    </td>
                </ng-container>

                <!-- Column: codeEquipe -->
                <ng-container matColumnDef="codeEquipe">
                    <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">Code Equipe</th>
                    <td mat-cell *matCellDef="let element">{{ element.codeEquipe }}</td>
                </ng-container>

                <!-- Column: adherents -->
                <ng-container matColumnDef="adherents">
                    <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">Adherents</th>
                    <td mat-cell *matCellDef="let equipe">
                        <button mat-icon-button (click)="showAdherentsPopup(equipe.adherents)">
                            <mat-icon>group</mat-icon>
                        </button>
                    </td>
                </ng-container>

                <!-- Column: Add Member -->
                <ng-container matColumnDef="addMember">
                    <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">Add Member</th>
                    <td mat-cell *matCellDef="let equipe">
                        <button mat-icon-button (click)="openAddMemberPopup(equipe)">
                            <mat-icon>add</mat-icon>
                        </button>
                    </td>
                </ng-container>

                <!-- Column: entraineurs -->
                <ng-container matColumnDef="entraineurs">
                    <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">Entraineurs</th>
                    <td mat-cell *matCellDef="let equipe">
                        <button mat-icon-button (click)="showEntraineursPopup(equipe.entraineurs)">
                            <mat-icon>sports_coach</mat-icon>
                        </button>
                    </td>
                </ng-container>

                <!-- Column: Add Entraineur -->
                <ng-container matColumnDef="addEntraineur">
                    <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">Add Entraineur</th>
                    <td mat-cell *matCellDef="let equipe" (click)="openAddEntraineurPopup(equipe)">
                        <button mat-icon-button>
                            <mat-icon>add</mat-icon>
                        </button>
                    </td>
                </ng-container>



                <!-- Column: action -->
                <ng-container matColumnDef="action">
                    <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">Action</th>
                    <td mat-cell *matCellDef="let equipe">
                        <button mat-icon-button color="warn" (click)="onDeleteEquipe(equipe.id)">
                            <mat-icon>delete_outline</mat-icon>
                        </button>
                        <button mat-icon-button style="color: gray;" (click)="openUpdateDialog(equipe)">
                            <mat-icon>edit</mat-icon>
                        </button>
                    </td>
                </ng-container>


                <!-- Table rows -->
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
            <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons class="gray-background"></mat-paginator>
        </div>
    </mat-card-content>
</mat-card>

<style>
    .error-message {
        color: #ff0000;
        /* Red color for error messages */
        font-size: 12px;
        /* Adjust font size */
        font-style: italic;
        /* Italics */
        margin-top: 4px;
        /* Adjust spacing from the field */
    }

    .gray-background {
        background-color: #FAFAFA;
        /*testing color blue: 0000FF*/
    }

    .custom-file-upload {
        display: inline-block;
        position: relative;
    }

    .file-upload-label {
        display: inline-block;
        padding: 8px 12px;
        background-color: #B7EE3E;
        color: #fff;
        border-radius: 4px;
        cursor: pointer;
    }

    .file-upload-label span {
        vertical-align: middle;
    }

    /* Hide the actual file input */
    input[type="file"] {
        display: none;
    }

    .custom-file-upload .file-upload-label {
        display: flex;
        align-items: center;
        /* Align items vertically */
    }

    .custom-file-upload .file-upload-label mat-icon {
        margin-right: 8px;
        /* Adjust the spacing between the icon and the text */
    }
</style>